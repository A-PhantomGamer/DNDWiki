<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Character - D&D Campaign Wiki</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dm-mode.css">
    <link rel="stylesheet" href="css/character-sheet.css">
    <link rel="stylesheet" href="css/character-create.css">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="header-title">
                <span>D</span>
                <img src="img/dnd-ampersand.png" alt="D&D Ampersand">
                <span>D Campaign Wiki</span>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">Campaigns</a></li>
                    <li><a href="characters.html" class="active">Characters</a></li>
                    <li><a href="npcs.html">NPCs</a></li>
                    <li><a href="world.html">World</a></li>
                    <li><a href="lore.html">Lore</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section id="create-character">
            <h2>Create New Character</h2>
            
            <form id="character-form" class="character-form">
                <!-- Decorative elements -->
                <div class="form-decoration decoration-top-left"></div>
                <div class="form-decoration decoration-bottom-right"></div>
                
                <div class="form-section">
                    <h3>Character Information</h3>
                    <div class="basic-info-grid">
                        <div class="form-group">
                            <label for="character-name">Character Name</label>
                            <input type="text" id="character-name" required>
                        </div>
                        <div class="form-group">
                            <label for="character-race">Race</label>
                            <input type="text" id="character-race" required>
                        </div>
                        <div class="form-group">
                            <label for="character-class">Class</label>
                            <input type="text" id="character-class" required>
                        </div>
                    </div>
                    
                    <div class="basic-info-grid">
                        <div class="form-group">
                            <label for="character-level">Level</label>
                            <input type="number" id="character-level" min="1" max="20" value="1" required>
                        </div>
                        <div class="form-group">
                            <label for="character-background">Background</label>
                            <input type="text" id="character-background">
                        </div>
                        <div class="form-group">
                            <label for="character-alignment">Alignment</label>
                            <select id="character-alignment">
                                <option value="Lawful Good">Lawful Good</option>
                                <option value="Neutral Good">Neutral Good</option>
                                <option value="Chaotic Good">Chaotic Good</option>
                                <option value="Lawful Neutral">Lawful Neutral</option>
                                <option value="True Neutral">True Neutral</option>
                                <option value="Chaotic Neutral">Chaotic Neutral</option>
                                <option value="Lawful Evil">Lawful Evil</option>
                                <option value="Neutral Evil">Neutral Evil</option>
                                <option value="Chaotic Evil">Chaotic Evil</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="basic-info-grid">
                        <div class="form-group">
                            <label for="character-xp">Experience Points</label>
                            <input type="number" id="character-xp" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="character-campaign">Campaign</label>
                            <select id="character-campaign">
                                <option value="">None</option>
                                <!-- Campaigns will be loaded dynamically -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="character-player-name">Player Name</label>
                            <input type="text" id="character-player-name">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Ability Scores</h3>
                    <div class="ability-form-grid">
                        <div class="ability-box">
                            <div class="ability-label">Strength</div>
                            <input type="number" id="ability-str" class="ability-input" min="3" max="20" value="10" required>
                            <div class="ability-modifier" id="str-mod">+0</div>
                        </div>
                        <div class="ability-box">
                            <div class="ability-label">Dexterity</div>
                            <input type="number" id="ability-dex" class="ability-input" min="3" max="20" value="10" required>
                            <div class="ability-modifier" id="dex-mod">+0</div>
                        </div>
                        <div class="ability-box">
                            <div class="ability-label">Constitution</div>
                            <input type="number" id="ability-con" class="ability-input" min="3" max="20" value="10" required>
                            <div class="ability-modifier" id="con-mod">+0</div>
                        </div>
                        <div class="ability-box">
                            <div class="ability-label">Intelligence</div>
                            <input type="number" id="ability-int" class="ability-input" min="3" max="20" value="10" required>
                            <div class="ability-modifier" id="int-mod">+0</div>
                        </div>
                        <div class="ability-box">
                            <div class="ability-label">Wisdom</div>
                            <input type="number" id="ability-wis" class="ability-input" min="3" max="20" value="10" required>
                            <div class="ability-modifier" id="wis-mod">+0</div>
                        </div>
                        <div class="ability-box">
                            <div class="ability-label">Charisma</div>
                            <input type="number" id="ability-cha" class="ability-input" min="3" max="20" value="10" required>
                            <div class="ability-modifier" id="cha-mod">+0</div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Saving Throws</h3>
                    <div class="saving-throws-grid">
                        <div class="save-item">
                            <input type="checkbox" id="save-str-prof" class="save-proficiency">
                            <label for="save-str-prof" class="save-name">Strength</label>
                            <div class="save-modifier" id="save-str-mod">+0</div>
                        </div>
                        <div class="save-item">
                            <input type="checkbox" id="save-dex-prof" class="save-proficiency">
                            <label for="save-dex-prof" class="save-name">Dexterity</label>
                            <div class="save-modifier" id="save-dex-mod">+0</div>
                        </div>
                        <div class="save-item">
                            <input type="checkbox" id="save-con-prof" class="save-proficiency">
                            <label for="save-con-prof" class="save-name">Constitution</label>
                            <div class="save-modifier" id="save-con-mod">+0</div>
                        </div>
                        <div class="save-item">
                            <input type="checkbox" id="save-int-prof" class="save-proficiency">
                            <label for="save-int-prof" class="save-name">Intelligence</label>
                            <div class="save-modifier" id="save-int-mod">+0</div>
                        </div>
                        <div class="save-item">
                            <input type="checkbox" id="save-wis-prof" class="save-proficiency">
                            <label for="save-wis-prof" class="save-name">Wisdom</label>
                            <div class="save-modifier" id="save-wis-mod">+0</div>
                        </div>
                        <div class="save-item">
                            <input type="checkbox" id="save-cha-prof" class="save-proficiency">
                            <label for="save-cha-prof" class="save-name">Charisma</label>
                            <div class="save-modifier" id="save-cha-mod">+0</div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Skills</h3>
                    <div class="skills-grid">
                        <div class="skill-item">
                            <input type="checkbox" id="skill-acrobatics-prof" class="skill-proficiency">
                            <label for="skill-acrobatics-prof" class="skill-name">Acrobatics</label>
                            <span class="skill-ability">(Dex)</span>
                            <div class="skill-modifier" id="skill-acrobatics-mod">+0</div>
                        </div>
                        <div class="skill-item">
                            <input type="checkbox" id="skill-animal-handling-prof" class="skill-proficiency">
                            <label for="skill-animal-handling-prof" class="skill-name">Animal Handling</label>
                            <span class="skill-ability">(Wis)</span>
                            <div class="skill-modifier" id="skill-animal-handling-mod">+0</div>
                        </div>
                        <div class="skill-item">
                            <input type="checkbox" id="skill-arcana-prof" class="skill-proficiency">
                            <label for="skill-arcana-prof" class="skill-name">Arcana</label>
                            <span class="skill-ability">(Int)</span>
                            <div class="skill-modifier" id="skill-arcana-mod">+0</div>
                        </div>
                        <div class="skill-item">
                            <input type="checkbox" id="skill-athletics-prof" class="skill-proficiency">
                            <label for="skill-athletics-prof" class="skill-name">Athletics</label>
                            <span class="skill-ability">(Str)</span>
                            <div class="skill-modifier" id="skill-athletics-mod">+0</div>
                        </div>
                        <div class="skill-item">
                            <input type="checkbox" id="skill-deception-prof" class="skill-proficiency">
                            <label for="skill-deception-prof" class="skill-name">Deception</label>
                            <span class="skill-ability">(Cha)</span>
                            <div class="skill-modifier" id="skill-deception-mod">+0</div>
                        </div>
                        <div class="skill-item">
                            <input type="checkbox" id="skill-history-prof" class="skill-proficiency">
                            <label for="skill-history-prof" class="skill-name">History</label>
                            <span class="skill-ability">(Int)</span>
                            <div class="skill-modifier" id="skill-history-mod">+0</div>
                        </div>
                        <div class="skill-item">
                            <input type="checkbox" id="skill-insight-prof" class="skill-proficiency">
                            <label for="skill-insight-prof" class="skill-name">Insight</label>
                            <span class="skill-ability">(Wis)</span>
                            <div class="skill-modifier" id="skill-insight-mod">+0</div>
                        </div>
                        <div class="skill-item">
                            <input type="checkbox" id="skill-intimidation-prof" class="skill-proficiency">
                            <label for="skill-intimidation-prof" class="skill-name">Intimidation</label>
                            <span class="skill-ability">(Cha)</span>
                            <div class="skill-modifier" id="skill-intimidation-mod">+0</div>
                        </div>
                        <div class="skill-item">
                            <input type="checkbox" id="skill-investigation-prof" class="skill-proficiency">
                            <label for="skill-investigation-prof" class="skill-name">Investigation</label>
                            <span class="skill-ability">(Int)</span>
                            <div class="skill-modifier" id="skill-investigation-mod">+0</div>
                        </div>
                        <div class="skill-item">
                            <input type="checkbox" id="skill-medicine-prof" class="skill-proficiency">
                            <label for="skill-medicine-prof" class="skill-name">Medicine</label>
                            <span class="skill-ability">(Wis)</span>
                            <div class="skill-modifier" id="skill-medicine-mod">+0</div>
                        </div>
                        <div class="skill-item">
                            <input type="checkbox" id="skill-nature-prof" class="skill-proficiency">
                            <label for="skill-nature-prof" class="skill-name">Nature</label>
                            <span class="skill-ability">(Int)</span>
                            <div class="skill-modifier" id="skill-nature-mod">+0</div>
                        </div>
                        <div class="skill-item">
                            <input type="checkbox" id="skill-perception-prof" class="skill-proficiency">
                            <label for="skill-perception-prof" class="skill-name">Perception</label>
                            <span class="skill-ability">(Wis)</span>
                            <div class="skill-modifier" id="skill-perception-mod">+0</div>
                        </div>
                        <div class="skill-item">
                            <input type="checkbox" id="skill-performance-prof" class="skill-proficiency">
                            <label for="skill-performance-prof" class="skill-name">Performance</label>
                            <span class="skill-ability">(Cha)</span>
                            <div class="skill-modifier" id="skill-performance-mod">+0</div>
                        </div>
                        <div class="skill-item">
                            <input type="checkbox" id="skill-persuasion-prof" class="skill-proficiency">
                            <label for="skill-persuasion-prof" class="skill-name">Persuasion</label>
                            <span class="skill-ability">(Cha)</span>
                            <div class="skill-modifier" id="skill-persuasion-mod">+0</div>
                        </div>
                        <div class="skill-item">
                            <input type="checkbox" id="skill-religion-prof" class="skill-proficiency">
                            <label for="skill-religion-prof" class="skill-name">Religion</label>
                            <span class="skill-ability">(Int)</span>
                            <div class="skill-modifier" id="skill-religion-mod">+0</div>
                        </div>
                        <div class="skill-item">
                            <input type="checkbox" id="skill-sleight-of-hand-prof" class="skill-proficiency">
                            <label for="skill-sleight-of-hand-prof" class="skill-name">Sleight of Hand</label>
                            <span class="skill-ability">(Dex)</span>
                            <div class="skill-modifier" id="skill-sleight-of-hand-mod">+0</div>
                        </div>
                        <div class="skill-item">
                            <input type="checkbox" id="skill-stealth-prof" class="skill-proficiency">
                            <label for="skill-stealth-prof" class="skill-name">Stealth</label>
                            <span class="skill-ability">(Dex)</span>
                            <div class="skill-modifier" id="skill-stealth-mod">+0</div>
                        </div>
                        <div class="skill-item">
                            <input type="checkbox" id="skill-survival-prof" class="skill-proficiency">
                            <label for="skill-survival-prof" class="skill-name">Survival</label>
                            <span class="skill-ability">(Wis)</span>
                            <div class="skill-modifier" id="skill-survival-mod">+0</div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Combat Stats</h3>
                    <div class="combat-stats-grid">
                        <div class="combat-stat-box">
                            <div class="combat-stat-label">Armor Class</div>
                            <input type="number" id="character-ac" class="combat-stat-input" min="1" value="10" required>
                        </div>
                        <div class="combat-stat-box">
                            <div class="combat-stat-label">Hit Points</div>
                            <input type="number" id="character-hp-max" class="combat-stat-input" min="1" value="10" required>
                        </div>
                        <div class="combat-stat-box">
                            <div class="combat-stat-label">Initiative</div>
                            <input type="number" id="character-initiative" class="combat-stat-input" value="0">
                        </div>
                        <div class="combat-stat-box">
                            <div class="combat-stat-label">Speed</div>
                            <input type="text" id="character-speed" class="combat-stat-input" value="30" style="font-size: 1.4em;" required>
                            <div style="font-size: 0.8em; margin-top: -5px;">ft.</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="character-hit-dice">Hit Dice</label>
                        <input type="text" id="character-hit-dice" placeholder="e.g., 1d8">
                    </div>
                    
                    <div class="form-group">
                        <label for="character-proficiency-bonus">Proficiency Bonus</label>
                        <input type="number" id="character-proficiency-bonus" value="2" min="0">
                    </div>
                </div>

                <div class="form-section">
                    <h3>Proficiencies & Languages</h3>
                    <div class="proficiencies-grid">
                        <div class="form-group">
                            <label for="character-weapon-prof">Weapon Proficiencies</label>
                            <textarea id="character-weapon-prof" class="proficiencies-textarea"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="character-armor-prof">Armor Proficiencies</label>
                            <textarea id="character-armor-prof" class="proficiencies-textarea"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="character-tool-prof">Tool Proficiencies</label>
                            <textarea id="character-tool-prof" class="proficiencies-textarea"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="character-languages">Languages</label>
                            <textarea id="character-languages" class="proficiencies-textarea"></textarea>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Background & Personality</h3>
                    <div class="background-grid">
                        <div class="background-item">
                            <label class="background-label" for="character-traits">Personality Traits</label>
                            <textarea id="character-traits" class="background-textarea"></textarea>
                        </div>
                        <div class="background-item">
                            <label class="background-label" for="character-ideals">Ideals</label>
                            <textarea id="character-ideals" class="background-textarea"></textarea>
                        </div>
                        <div class="background-item">
                            <label class="background-label" for="character-bonds">Bonds</label>
                            <textarea id="character-bonds" class="background-textarea"></textarea>
                        </div>
                        <div class="background-item">
                            <label class="background-label" for="character-flaws">Flaws</label>
                            <textarea id="character-flaws" class="background-textarea"></textarea>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Campaign</h3>
                    <div class="form-group">
                        <label for="character-campaign">Campaign</label>
                        <select id="character-campaign">
                            <option value="">None</option>
                            <!-- Campaigns will be loaded dynamically -->
                        </select>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" id="cancel-create" class="btn secondary-btn">Cancel</button>
                    <button type="submit" class="btn primary-btn">Create Character</button>
                </div>
            </form>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <p>&copy; 2023 D&D Campaign Wiki</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Load campaigns for dropdown
            const campaignSelect = document.getElementById('character-campaign');
            const campaigns = JSON.parse(localStorage.getItem('campaigns')) || [];
            
            campaigns.forEach(campaign => {
                const option = document.createElement('option');
                option.value = campaign.id;
                option.textContent = campaign.name;
                campaignSelect.appendChild(option);
            });
            
            // Calculate ability modifiers
            const abilityInputs = document.querySelectorAll('.ability-input');
            abilityInputs.forEach(input => {
                input.addEventListener('change', updateModifiers);
            });
            
            // Update proficiency bonus based on level
            document.getElementById('character-level').addEventListener('change', updateProficiencyBonus);
            
            // Update saving throws and skills when ability scores or proficiency bonus changes
            abilityInputs.forEach(input => {
                input.addEventListener('change', updateSavingThrows);
                input.addEventListener('change', updateSkills);
            });
            
            document.getElementById('character-proficiency-bonus').addEventListener('change', updateSavingThrows);
            document.getElementById('character-proficiency-bonus').addEventListener('change', updateSkills);
            
            // Update saving throws when proficiency checkboxes change
            const saveProfCheckboxes = document.querySelectorAll('.save-proficiency');
            saveProfCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateSavingThrows);
            });
            
            // Update skills when proficiency checkboxes change
            const skillProfCheckboxes = document.querySelectorAll('.skill-proficiency');
            skillProfCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateSkills);
            });
            
            // Update spell save DC and attack bonus when spellcasting ability changes
            document.getElementById('character-spellcasting-ability').addEventListener('change', updateSpellcasting);
            
            function updateModifiers() {
                const abilities = ['str', 'dex', 'con', 'int', 'wis', 'cha'];
                abilities.forEach(ability => {
                    const score = parseInt(document.getElementById(`ability-${ability}`).value);
                    const modifier = Math.floor((score - 10) / 2);
                    const modElement = document.getElementById(`${ability}-mod`);
                    modElement.textContent = modifier >= 0 ? `+${modifier}` : modifier;
                });
                
                // Update saving throws and skills when ability scores change
                updateSavingThrows();
                updateSkills();
            }
            
            function updateProficiencyBonus() {
                const level = parseInt(document.getElementById('character-level').value);
                let profBonus = 2;
                
                if (level >= 5) profBonus = 3;
                if (level >= 9) profBonus = 4;
                if (level >= 13) profBonus = 5;
                if (level >= 17) profBonus = 6;
                
                document.getElementById('character-proficiency-bonus').value = profBonus;
                
                // Update saving throws and skills when proficiency bonus changes
                updateSavingThrows();
                updateSkills();
            }
            
            function updateSavingThrows() {
                const abilities = ['str', 'dex', 'con', 'int', 'wis', 'cha'];
                const profBonus = parseInt(document.getElementById('character-proficiency-bonus').value);
                
                abilities.forEach(ability => {
                    const score = parseInt(document.getElementById(`ability-${ability}`).value);
                    const modifier = Math.floor((score - 10) / 2);
                    const isProficient = document.getElementById(`save-${ability}-prof`).checked;
                    
                    const saveModifier = modifier + (isProficient ? profBonus : 0);
                    const saveModElement = document.getElementById(`save-${ability}-mod`);
                    saveModElement.textContent = saveModifier >= 0 ? `+${saveModifier}` : saveModifier;
                });
            }
            
            function updateSkills() {
                const skillMap = {
                    'acrobatics': 'dex',
                    'animal-handling': 'wis',
                    'arcana': 'int',
                    'athletics': 'str',
                    'deception': 'cha',
                    'history': 'int',
                    'insight': 'wis',
                    'intimidation': 'cha',
                    'investigation': 'int',
                    'medicine': 'wis',
                    'nature': 'int',
                    'perception': 'wis',
                    'performance': 'cha',
                    'persuasion': 'cha',
                    'religion': 'int',
                    'sleight-of-hand': 'dex',
                    'stealth': 'dex',
                    'survival': 'wis'
                };
                
                const profBonus = parseInt(document.getElementById('character-proficiency-bonus').value);
                
                for (const skill in skillMap) {
                    const ability = skillMap[skill];
                    const score = parseInt(document.getElementById(`ability-${ability}`).value);
                    const modifier = Math.floor((score - 10) / 2);
                    const isProficient = document.getElementById(`skill-${skill}-prof`).checked;
                    
                    const skillModifier = modifier + (isProficient ? profBonus : 0);
                    const skillModElement = document.getElementById(`skill-${skill}-mod`);
                    skillModElement.textContent = skillModifier >= 0 ? `+${skillModifier}` : skillModifier;
                }
            }
            
            function updateSpellcasting() {
                const spellAbility = document.getElementById('character-spellcasting-ability').value;
                if (!spellAbility) return;
                
                let abilityMod = 0;
                switch(spellAbility) {
                    case 'Intelligence':
                        abilityMod = Math.floor((parseInt(document.getElementById('ability-int').value) - 10) / 2);
                        break;
                    case 'Wisdom':
                        abilityMod = Math.floor((parseInt(document.getElementById('ability-wis').value) - 10) / 2);
                        break;
                    case 'Charisma':
                        abilityMod = Math.floor((parseInt(document.getElementById('ability-cha').value) - 10) / 2);
                        break;
                }
                
                const profBonus = parseInt(document.getElementById('character-proficiency-bonus').value);
                const spellSaveDC = 8 + profBonus + abilityMod;
                const spellAttackBonus = profBonus + abilityMod;
                
                document.getElementById('character-spell-save-dc').value = spellSaveDC;
                document.getElementById('character-spell-attack-bonus').value = spellAttackBonus;
            }
            
            // Handle form submission
            const form = document.getElementById('character-form');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Create character object
                const character = {
                    id: Date.now().toString(),
                    name: document.getElementById('character-name').value,
                    race: document.getElementById('character-race').value,
                    class: document.getElementById('character-class').value,
                    level: parseInt(document.getElementById('character-level').value),
                    background: document.getElementById('character-background').value,
                    alignment: document.getElementById('character-alignment').value,
                    experience: document.getElementById('character-xp').value,
                    campaign: document.getElementById('character-campaign').value,
                    playerName: document.getElementById('character-player-name').value,
                    
                    // Abilities
                    abilities: {
                        str: parseInt(document.getElementById('ability-str').value),
                        dex: parseInt(document.getElementById('ability-dex').value),
                        con: parseInt(document.getElementById('ability-con').value),
                        int: parseInt(document.getElementById('ability-int').value),
                        wis: parseInt(document.getElementById('ability-wis').value),
                        cha: parseInt(document.getElementById('ability-cha').value)
                    },
                    
                    // Saving throws
                    savingThrows: {
                        str: parseInt(document.getElementById('save-str-mod').textContent),
                        dex: parseInt(document.getElementById('save-dex-mod').textContent),
                        con: parseInt(document.getElementById('save-con-mod').textContent),
                        int: parseInt(document.getElementById('save-int-mod').textContent),
                        wis: parseInt(document.getElementById('save-wis-mod').textContent),
                        cha: parseInt(document.getElementById('save-cha-mod').textContent)
                    },
                    
                    // Skills
                    skills: {
                        acrobatics: parseInt(document.getElementById('skill-acrobatics-mod').textContent),
                        animalHandling: parseInt(document.getElementById('skill-animal-handling-mod').textContent),
                        arcana: parseInt(document.getElementById('skill-arcana-mod').textContent),
                        athletics: parseInt(document.getElementById('skill-athletics-mod').textContent),
                        deception: parseInt(document.getElementById('skill-deception-mod').textContent),
                        history: parseInt(document.getElementById('skill-history-mod').textContent),
                        insight: parseInt(document.getElementById('skill-insight-mod').textContent),
                        intimidation: parseInt(document.getElementById('skill-intimidation-mod').textContent),
                        investigation: parseInt(document.getElementById('skill-investigation-mod').textContent),
                        medicine: parseInt(document.getElementById('skill-medicine-mod').textContent),
                        nature: parseInt(document.getElementById('skill-nature-mod').textContent),
                        perception: parseInt(document.getElementById('skill-perception-mod').textContent),
                        performance: parseInt(document.getElementById('skill-performance-mod').textContent),
                        persuasion: parseInt(document.getElementById('skill-persuasion-mod').textContent),
                        religion: parseInt(document.getElementById('skill-religion-mod').textContent),
                        sleightOfHand: parseInt(document.getElementById('skill-sleight-of-hand-mod').textContent),
                        stealth: parseInt(document.getElementById('skill-stealth-mod').textContent),
                        survival: parseInt(document.getElementById('skill-survival-mod').textContent)
                    },
                    
                    // Combat stats
                    hp: {
                        current: parseInt(document.getElementById('character-hp-max').value),
                        max: parseInt(document.getElementById('character-hp-max').value),
                        temporary: 0
                    },
                    ac: parseInt(document.getElementById('character-ac').value),
                    initiative: parseInt(document.getElementById('character-initiative').value) || 0,
                    speed: document.getElementById('character-speed').value,
                    hitDice: document.getElementById('character-hit-dice').value || `${document.getElementById('character-level').value}d8`,
                    proficiencyBonus: parseInt(document.getElementById('character-proficiency-bonus').value),
                    
                    // Proficiencies
                    proficiencies: {
                        weapons: document.getElementById('character-weapon-prof').value,
                        armor: document.getElementById('character-armor-prof').value,
                        tools: document.getElementById('character-tool-prof').value,
                        savingThrows: Array.from(document.querySelectorAll('.save-proficiency:checked'))
                            .map(el => el.id.replace('save-', '').replace('-prof', ''))
                            .join(', '),
                        skills: Array.from(document.querySelectorAll('.skill-proficiency:checked'))
                            .map(el => el.id.replace('skill-', '').replace('-prof', ''))
                            .join(', ')
                    },
                    
                    // Languages
                    languages: document.getElementById('character-languages').value,
                    
                    // Equipment
                    equipment: {
                        weapons: document.getElementById('character-weapons').value,
                        armor: document.getElementById('character-armor').value,
                        gear: document.getElementById('character-gear').value,
                        treasure: document.getElementById('character-treasure').value,
                        currency: {
                            cp: parseInt(document.getElementById('character-cp').value) || 0,
                            sp: parseInt(document.getElementById('character-sp').value) || 0,
                            ep: parseInt(document.getElementById('character-ep').value) || 0,
                            gp: parseInt(document.getElementById('character-gp').value) || 0,
                            pp: parseInt(document.getElementById('character-pp').value) || 0
                        }
                    },
                    
                    // Features
                    features: {
                        classFeatures: document.getElementById('character-class-features').value,
                        racialTraits: document.getElementById('character-racial-traits').value,
                        feats: document.getElementById('character-feats').value
                    },
                    
                    // Background & Personality
                    personalityTraits: document.getElementById('character-traits').value,
                    ideals: document.getElementById('character-ideals').value,
                    bonds: document.getElementById('character-bonds').value,
                    flaws: document.getElementById('character-flaws').value,
                    backstory: document.getElementById('character-backstory').value,
                    
                    // Appearance
                    appearance: {
                        age: document.getElementById('character-age').value,
                        height: document.getElementById('character-height').value,
                        weight: document.getElementById('character-weight').value,
                        eyes: document.getElementById('character-eyes').value,
                        skin: document.getElementById('character-skin').value,
                        hair: document.getElementById('character-hair').value,
                        description: document.getElementById('character-appearance-desc').value
                    },
                    
                    // Spellcasting
                    spellcasting: {
                        class: document.getElementById('character-spellcasting-class').value,
                        ability: document.getElementById('character-spellcasting-ability').value,
                        saveDC: parseInt(document.getElementById('character-spell-save-dc').value) || 0,
                        attackBonus: parseInt(document.getElementById('character-spell-attack-bonus').value) || 0,
                        spellSlots: {
                            level1: { total: parseInt(document.getElementById('spell-slots-level1').value) || 0, used: 0 },
                            level2: { total: parseInt(document.getElementById('spell-slots-level2').value) || 0, used: 0 },
                            level3: { total: parseInt(document.getElementById('spell-slots-level3').value) || 0, used: 0 },
                            level4: { total: parseInt(document.getElementById('spell-slots-level4').value) || 0, used: 0 },
                            level5: { total: parseInt(document.getElementById('spell-slots-level5').value) || 0, used: 0 },
                            level6: { total: parseInt(document.getElementById('spell-slots-level6').value) || 0, used: 0 },
                            level7: { total: parseInt(document.getElementById('spell-slots-level7').value) || 0, used: 0 },
                            level8: { total: parseInt(document.getElementById('spell-slots-level8').value) || 0, used: 0 },
                            level9: { total: parseInt(document.getElementById('spell-slots-level9').value) || 0, used: 0 }
                        }
                    },
                    
                    // Spells
                    spells: {
                        cantrips: document.getElementById('character-cantrips').value.split(',').map(s => s.trim()).filter(s => s),
                        level1: document.getElementById('character-spells-level1').value.split(',').map(s => s.trim()).filter(s => s),
                        level2: document.getElementById('character-spells-level2').value.split(',').map(s => s.trim()).filter(s => s),
                        level3: document.getElementById('character-spells-level3').value.split(',').map(s => s.trim()).filter(s => s),
                        level4: [],
                        level5: [],
                        level6: [],
                        level7: [],
                        level8: [],
                        level9: []
                    },
                    
                    // Allies & Organizations
                    backgroundDetails: {
                        allies: document.getElementById('character-allies').value,
                        enemies: document.getElementById('character-enemies').value,
                        organizations: document.getElementById('character-organizations').value,
                        backstory: document.getElementById('character-backstory').value
                    },
                    
                    // Notes
                    notes: document.getElementById('character-notes').value,
                    
                    // Metadata
                    dateCreated: new Date().toISOString(),
                    sourceType: 'manual'
                };
                
                // Save to localStorage
                const characters = JSON.parse(localStorage.getItem('characters')) || [];
                characters.push(character);
                localStorage.setItem('characters', JSON.stringify(characters));
                
                // Redirect to characters page
                window.location.href = 'characters.html';
            });
            
            // Handle cancel button
            document.getElementById('cancel-create').addEventListener('click', function() {
                window.location.href = 'characters.html';
            });
            
            // Initialize modifiers
            updateModifiers();
            updateProficiencyBonus();
        });
    </script>
</body>
</html>




